{%- comment -%}
Usage:

  {% include presets/maps.html maptype="lanoscea" %}

Expects a JSON file at:
  /assets/leaflet/maps/{{ maptype }}.json

Treasure map marker (fixed map area, toggleable, searchable, and visible in legend):

{
  "id": "tm-1",
  "name": "Treasure Map 1",
  "type": "treasuremap_dragonskin",  // must start with "treasuremap_"
  "category": "treasuremap_dragonskin",
  "imageUrl": "/assets/leaflet/treasures/map1.png",
  "position": [900, 1100],            // center (x,y) in map pixels
  "size": [400, 400],                 // width/height in map pixels (optional)
  "description": "Dig here!"
}

Category-level image:

{
  "id": "angel_fishing",
  "name": "Fishing - Angel",
  "group": "angel_fishing",
  "groupName": "Fishing",
  "imageUrl": "/assets/img/content/map/angel.webp",
  "size": [333.3, 333.3]
}

Marker-level image:

{
  "type": "angel_fishing",
  "name": "Karvarhur die Erste",
  "imageUrl": "/assets/img/content/map/angel.webp",
  "size": [333.3, 333.3],
  "position": [265, 1082]
}

Rules:

- For all markers, the effective category id is: marker.category || marker.type
- Treasuremap overlays are created when:
    typeof marker.type === "string" && marker.type.startsWith("treasuremap_")
- Category-level images:
    - cat.imageUrl (or cat.iconUrl/icon) is used as marker image.
    - If cat.size or cat.iconSize exists, it is used as iconSize.
    - Image is centered on the point.
- Marker-level images:
    - m.imageUrl overrides category icon.
    - If m.size exists, it is used as iconSize.
    - Image is centered on the point.
{%- endcomment -%}

<div class="gm-wrap"
      {%- if x == "FATEs" -%}
        data-gm-filter="group:FATEs"
      {%- elsif page.slug -%}
        data-gm-filter="{{ "cat:treasuremap_" | append: page.slug }} "
      {%- elsif x == "Zones" -%}
        data-gm-filter="group:Schatzkarten"
      {%- endif -%}
        data-gm-filter-mode="only"
      data-map-url="{{ '/assets/leaflet/maps/' | append: include.maptype | append: '.json' | relative_url }}">
  <div class="gm-inner">
    <div class="gm-header">
      <span class="gm-title">Loading map…</span>
    </div>
    <div class="gm-body">
      <div class="gm-sidebar">
        <div class="gm-search">
          <input type="text" class="gm-search-input" placeholder="Search markers & zones…" />
        </div>
        <div class="gm-legend-controls">
          <button type="button" class="gm-legend-button" data-action="show-all">Show all</button>
          <button type="button" class="gm-legend-button" data-action="hide-all">Hide all</button>
        </div>
        <div class="gm-groups"></div>
      </div>
      <div class="gm-map"></div>
    </div>
  </div>
</div>
